<%
public_ip = "10.0.0.81"
%>
---
driver:
  name: vagrant
  customize:
    cpus: 4
    memory: 8192

client_rb:
  treat_deprecation_warnings_as_errors: true
  resource_cloning: false

provisioner:
  name: chef_zero
  # You may wish to disable always updating cookbooks in CI or other testing
  # environments.
  # For example:
  #   always_update_cookbooks: <%= !ENV['CI'] %>
  always_update_cookbooks: true
  product_name: chef
  product_version: 14
  # Copy secret to /tmp/kitchen on test VM. Kitchen tries to gather secrets
  # before any recipes had a chance to run -> we cannot use a recipe to put the
  # secrets file in place.
  encrypted_data_bag_secret_key_path: .chef/encrypted_data_bag_secret
  roles_path: roles
  environments_path: environments
  attributes:
    openstack:
      secret:
        key_path: /tmp/kitchen/encrypted_data_bag_secret

verifier:
  name: inspec

platforms:
  - name: ubuntu-18.04
    driver:
      box: ubuntu/bionic64
  - name: centos-7
    driver:
      box: centos/7

suites:
  - name: default
    run_list:
      - recipe[openstack_test]
      - role[allinone]
    driver_config:
      network:
      - ["private_network", {ip: <%= public_ip %>}]
    provisioner:
      client_rb:
        environment: allinone
    verifier:
      inspec_tests:
        - test/tempest/default
  - name: minimal
    run_list:
      - recipe[openstack_test]
      - role[minimal]
    driver_config:
      network:
      - ["private_network", {ip: <%= public_ip %>}]
    provisioner:
      client_rb:
        environment: integration
    verifier:
      inspec_tests:
        - test/tempest/default
